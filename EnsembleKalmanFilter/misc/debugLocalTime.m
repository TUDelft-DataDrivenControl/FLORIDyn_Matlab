d = distOPs(:);
c = sqrt(10/3)*1000;



for i = 1:30
    cov11 = .5*(sign(d) - sign(d-c));
    cov12 = - 1/4*(d/c).*(d/c).*(d/c).*(d/c).*(d/c);
    cov12 = cov12 + 1/2*(d/c).*(d/c).*(d/c).*(d/c);
    cov12 = cov12 + 5/8*(d/c).*(d/c).*(d/c);
    cov12 = cov12 - 5/3*(d/c).^2 + 1;
    
    cov13 = .5*(sign(d) - sign(d-c)).*(...
        - 1/4*(d/c).*(d/c).*(d/c).*(d/c).*(d/c)...
        + 1/2*(d/c).*(d/c).*(d/c).*(d/c)...
        + 5/8*(d/c).*(d/c).*(d/c)...
        - 5/3*(d/c).^2 + 1);
    
    cov13 = .5*(sign(d) - sign(d-c)).*(...
        (((- 1/4*(d/c)+ 1/2).*(d/c) + 5/8).*(d/c) - 5/3).*(d/c).*(d/c)+ 1);
    
    
    cov21 = .5*(sign(d-c) - sign(d-2*c));
    cov22 = (...
        1/12*(d./c).^5 ...
        - 0.5*(d./c).^4 ...
        + 5/8*(d./c).^3 ...
        + 5/3*(d./c).^2 ...
        - 5*(d./c) + 4 ...
        - 2/3*(c./d));
    
    cov = cov11.*cov12+cov21.*cov22;
    cov(isnan(cov))=1;
end

%%

f_comb =@(d) .5*(sign(d) - sign(d-c)).*(...
        (((-1/4*(d./c) + 1/2).*(d./c) + 5/8).*(d./c) - 5/3) ...
        .*(d./c).*(d./c) + 1)...
        + .5*(sign(d-c) - sign(d-2*c)).*(...
        ((((1/12*(d./c) - 0.5).*(d./c) + 5/8).*(d./c) + 5/3).*(d./c) - 5).*(d./c) ...
        + 4 - 2/3*(c./d));
f_sepa =@(d) .5*(sign(d) - sign(d-c)).*(...
        - 1/4*(d./c).*(d./c).*(d./c).*(d./c).*(d./c) ...
        + 1/2*(d./c).*(d./c).*(d./c).*(d./c) ...
        + 5/8*(d./c).*(d./c).*(d./c) ...
        - 5/3*(d./c).*(d./c) + 1) ...
        + .5*(sign(d-c) - sign(d-2*c)).*(...
         1/12*(d./c).*(d./c).*(d./c).*(d./c).*(d./c) ...
        - 0.5*(d./c).*(d./c).*(d./c).*(d./c) ...
        + 5/8*(d./c).*(d./c).*(d./c) ...
        + 5/3*(d./c).*(d./c) ...
        - 5*(d./c) + 4 ...
        - 2/3*(c./d));
    
    
figure
c = 2;
x = linspace(-5,5);
plot(x,f_comb(abs(x)))
hold on
plot(x,f_sepa(abs(x)))
hold off
grid on